# Telegram Planning Bot

–ë–æ—Ç –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (07:00 –ø–æ –≤–∞—à–µ–º—É –≤—Ä–µ–º–µ–Ω–∏) –∏ –≤–µ—á–µ—Ä–Ω–µ–π —Å–≤–µ—Ä–∫–∏ –∑–∞–¥–∞—á (21:00).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **/start** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—ã–±–æ—Ä —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —É—Ç—Ä–µ–Ω–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–ª–∞–Ω–∞
- –ü—Ä–∏—ë–º –ø–ª–∞–Ω–∞ (–º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á)
- –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è: **/plan** (–µ—Å–ª–∏ –ø–ª–∞–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â—ë –Ω–µ—Ç)
- –í–µ—á–µ—Ä–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ / ‚ö† –ß–∞—Å—Ç–∏—á–Ω–æ / ‚ùå –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: **/today**, **/history YYYY-MM**, **/stats**

## –°—Ç–µ–∫

- Python 3.11, aiogram 3, FastAPI (webhook), Celery + Redis, PostgreSQL, Alembic

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (Docker)

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥:
   ```bash
   cd bot
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –∏ –∑–∞–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:
   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env: TELEGRAM_BOT_TOKEN=... (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
   ```bash
   docker-compose up -d
   ```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook (–Ω—É–∂–µ–Ω HTTPS-–∞–¥—Ä–µ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä ngrok):
   ```bash
   curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook?url=https://YOUR_DOMAIN/webhook"
   ```

5. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ–º–µ–Ω–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å long-polling (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞¬ª).

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather |
| `WEBHOOK_SECRET` | (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ webhook |
| `WEBHOOK_BASE_URL` | –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è setWebhook (–Ω–∞–ø—Ä–∏–º–µ—Ä https://your-domain.com) |
| `DATABASE_URL` | PostgreSQL (async): `postgresql+asyncpg://user:pass@host:5432/db` |
| `REDIS_URL` | Redis: `redis://host:6379/0` |

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- **/start** ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≤—ã–±–æ—Ä —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- **/plan** ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –≤–≤–æ–¥ –ø–ª–∞–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –ø–ª–∞–Ω–∞ –µ—â—ë –Ω–µ—Ç)
- **/today** ‚Äî –ø–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **/history YYYY-MM** ‚Äî —Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ –∑–∞ –º–µ—Å—è—Ü (–Ω–∞–ø—Ä–∏–º–µ—Ä `/history 2025-01`)
- **/stats** ‚Äî –≤—Å–µ–≥–æ –ø–ª–∞–Ω–æ–≤, —Å—Ä–µ–¥–Ω–∏–π % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫ (–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ 100%)
- **/settings** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **/timezone** ‚Äî —Å–º–µ–Ω–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
- **/help** –∏–ª–∏ **/commands** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

## –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

**–£—Ç—Ä–æ (07:00):**  
¬´–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ù–∞–ø–∏—à–∏ –ø–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ‚Äî –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏. –ü—Ä–∏–º–µ—Ä: 1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Ç—á—ë—Ç 2. –í—Å—Ç—Ä–µ—á–∞ –≤ 11:00 3. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞¬ª  
–ö–Ω–æ–ø–∫–∏: [–û—Ç–ø—Ä–∞–≤–∏–ª ‚úÖ] [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è ‚è≠]

**–í–µ—á–µ—Ä (21:00):**  
–ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ [‚úÖ] [‚ö†] [‚ùå] [üí¨] –ø–æ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ ‚Äî –∏—Ç–æ–≥ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –¥–Ω—é.

## –î–µ–ø–ª–æ–π –Ω–∞ VPS

1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ Docker Compose.
2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Å–æ–∑–¥–∞–π—Ç–µ `.env` —Å `TELEGRAM_BOT_TOKEN`, `DATABASE_URL`, `REDIS_URL`, `WEBHOOK_BASE_URL`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   docker-compose up -d
   ```
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ CMD):
   ```bash
   docker-compose exec app alembic upgrade head
   ```
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:
   ```bash
   curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook?url=https://YOUR_DOMAIN/webhook"
   ```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å –∑–∞ Nginx/HTTPS –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å `POST /webhook` –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `app:8000`.

**–ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥:** –ø–æ—à–∞–≥–æ–≤—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Ubuntu (–≤ —Ç–æ–º —á–∏—Å–ª–µ –≤—Ç–æ—Ä–æ–π/–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä) –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook ‚Äî [docs/DEPLOYMENT_UBUNTU_WEBHOOK.md](docs/DEPLOYMENT_UBUNTU_WEBHOOK.md).  
**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –ø–æ–¥ —Å–µ—Ä–≤–µ—Ä:** DNS, Nginx, HTTPS, webhook ‚Äî [docs/DOMAIN_SETUP.md](docs/DOMAIN_SETUP.md).

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `pip install -e ".[dev]"`
- –ú–∏–≥—Ä–∞—Ü–∏–∏: `alembic upgrade head`
- Unit-—Ç–µ—Å—Ç—ã: `pytest tests/unit -v`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–Ω—É–∂–Ω—ã PostgreSQL –∏ Redis): `pytest tests/integration -v -m integration`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
